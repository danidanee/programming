# 데드락

> 교착 상태’라고도 하며 한정된 자원을 여러 곳에서 사용하려고 할 때 발생

<br/>

**임계 구역**

* 여러 개의 프로세스가 공유하는 데이터 및 자원에 대해 어느 한 시점에서 하나의 프로세스만 자원 또는 데이터를 사용하도록 지정된 공유 공간
* 하나의 프로세스만 접근 가능하고, 해당 프로세스는 자원을 반납한 후에만 다른 프로세시가 자원, 데이터를 사용 가능
* 임계 구역은 특정 프로세스가 독점 불가
* 프로세스가 진입 요청하면 일정 시간 내 진입을 허용함

<br/>

### 데드락의 발생 조건

> 상호배제, 점유대기, 비선점, 순환대기

* 아래의 네 가지 조건 중 하나라도 성립하지 않도록 만든다면 교착상태를 해결할 수 있다.

<br/>

1. 상호배제
   * 프로세서들이 자원을 배타적 점유, 다른 프로세서들이 자원 사용 불가
     * 상호배제를 한다 → 남 안 주고 공유하지도 않고 오로지 나만 쓰는 상황 
   * 한번에 한 프로세스만이 자원 사용 가능
   * `해결책` : 공유자원을 어느 시점에서 단지 한 개의 프로세스만이 사용하고 다른 프로세스가 공유자원에 접근 못하게 제어
     * 임계 구역을 유지하기 위함 (데커 A)
2. 점유와 대기
   * 부분 할당, 다른 종류의 자원을 부가적으로 요구하면서, 이미 어떤 자원을 점유하고 있음
   * 공유된 자원을 가진 상태에서 또 다른 것을 요구하는 것
   * `해결책` : 프로세스가 자신에게 필요한 자원들을 한꺼번에 요구하고 동시에 허용될 떄까지 프로세스를 보류시키는 것거나 자원을 가지고 있지 않을 때만 자원 요청을 허용
     * 많은 자원을 동시에 요구하는 것은 제한적
     * 모든 자원을 얻어야 실행하므로 성능이 않좋아지며, 자원의 활용도가 떨어진다
3. 비선점
   * 자원들은 그들이 점유하고 있는 프로세스로부터 도중에 해체되지 않음
   * 예시 : 교통체증 문제에서 보면, 몇 차만 후진해서 양보해주면 데드락이 발생하지 않는데, 내양보하기 싫어서 오도 갈 수 없는 상태에 빠지는 것
   * `해결책` : 프로세스가 필요한 자원을 가진 프로세스로 부터 그것을 잠시 빼앗아 올 수 있도록 한다
     * 뺏긴 프로세스의 실행이 지연될 수도 있다
4. 환형 대기
   * 프로세스와 자원들이 원형을 이루며, 각 프로세스는 자신에게 할당된 자원을 가지면서, 상대방 프로세스의 자원을 상호요청하는 경우
   * `해결책` : 모든 자원 타입에 번호를 부여해, 프로세스가 자원을 요구할 때 오름차순으로만 요구를 하게해 Circle이 형성되는 것을 막는다

<br/>

### 교착상태 처리 방법

<br/>

**교착상태 예방**

* 교착상태의 필요조건을 부정함으로써 교착상태가 발생하지 않도록 미리 예방하는 방법
* 상호배제, 점유와 대기, 비선점, 환형 대기 4가지 부정

<br/>

**교착상태 회피**

* 교착상태 가능성을 배제하지 않고 적절하게 피해가는 방법
* 은행원 알고리즘

<br/>

**교착상태 탐지**

* 교착상태 발생을 허용하고 발생 시 원인을 규명하여 해결하는 방법
* 자원할당 그래프

<br/>

**교착상태 복구**

* 교착상태 발견 후 환형대기를 배제시키거나 자원을 중단하는 메모리 할당 기법
* 선전, 프로세스 중지(희생자 선택)

<br/>

---

[참고 자료]

https://includestdio.tistory.com/12

https://kim-hoya.tistory.com/16

https://jhnyang.tistory.com/3