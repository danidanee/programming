# 프로세스와 스레드

> 프로세스 : 하나의 작업 단위로, 실행을 위해 메모리에 올라온 동적인 상태
>
> 스레드 : 프로세스 내에서 실행되는 여러 흐름의 단위

<br/>

* **프로그램** : 어떤 데이터를 사용해 어떤 작업을 할 지 적어놓은, 저장장치에 저장되어 있는 정적인 상태
  * 작성한 프로그램이 실행되면 프로세스가 된다 
  * 프로그램 : 레시피, 프로세스 : 요리

<br/>

### 프로세스

* 컴퓨터에서 연속적으로 실행되고 있는 컴퓨터 프로그램
* OS가 메모리 등 필요한 자원을 할당해준 실행 중인 프로그램
* 프로그램이 실행되어 메모리에 적재될 때 Code, Data, Stack, Heap 영역을 할당받으며 여기에 프로그램카운터를 포함하여 프로세스라고 한다.
* 각각의 프로세스는 서로 메모리 공간을 독자적으로 갖기 때문에 서로 메모리 공간을 공유하지 못한다
* 따라서 다른 프로세스의 메모리에 접근하려면 IPC과 같은 방식이 필요하다

<img src="https://media.vlpt.us/post-images/naljajm/fee95b30-e36c-11e9-95f8-879c9879902a/01.png">

<br/>

### 스레드

* 프로세스에서 실행되고 있는 여러 흐름의 최소 단위
* 한 프로세스는 최소 1개 이상의 스레드를 갖는다.
* 스레드는 프로세스 내에서 프로세스의 자원을 이용해서 실제로 **작업을 수행하는 일꾼**
* 스레드의 프로세스 내에서 각각의 stack 만 따로 할당을 받고 code, data, heap은 공유한다.
* Context switching시 Stack영역만 switching하면 되므로 프로세스 스위칭 보다 빠르다.
* 스레드는 메모리를 공유하기 때문에 편리하지만 동기화, 데드락 등의 문제가 발생 할 수 있다. 

<img src="https://media.vlpt.us/post-images/naljajm/0f17f700-e36d-11e9-95f8-879c9879902a/03.png"/>

<br/>

### 멀티 프로그래밍

* 초창기 싱글코어 싱글 스레드 컴퓨터에서는 프로그램이 메모리에 하나만 올라가고 해당하는 프로그램만 CPU가 처리를 진행할 수 있었다.
* 이런 과정에서 프로그램이 파일 입출력을하게 되면 중간에 idle(정지)상태가 되는데 이 때 다른 프로세스의 일부를 실행시키는걸 의미

<br/>

### 멀티 태스킹

* 같은 시간에 여러 개의 프로그램을 띄우는 것

<br/>

### 멀티프로세싱

* 여러 개의 프로세스를 사용하는 것
* 하나의 컴퓨터에 여러개의 CPU를 장착하고(CPU속에 멀티코어로 생각해도 무방합니다.) 하나 이상의 프로세스들을 동시에 처리하는걸 의미한다.
* 더 넓은 범위로 해석하면 하나 또은 그 이상의 프로세스를 여러 장치에서 병렬로 처리하는 것을 의미한다.
* 장점
  - 여러 개의 자식 프로세스 중 하나에 문제가 발생하면 그 자식 프로세스만 죽는 것 이상으로 다른 영향이 확산되지 않는다.
* 단점
  - Context Switching 오버헤드
    - Context Switching과정에서 캐쉬 메모리 초기화 등 무거운 작업이 진행되고 많은 시간이 소모되는 등의 오 버헤드가 발생하기 된다.
    - 프로세스는 각각의 독립된 메모리 영역을 할당받았기 때문에 프로세스 사이에서 공유하는 메모리가 없어, Context Switching이 발생하면 캐쉬에 있는 모든 데이터를 전부 리셋하고 다시 캐쉬정보를 불러와야 한다.
  - 하나의 프로그램에 속하는 프로세스들 사이의 변수를 공유할 수 없다.

<br/>

### 멀티 스레드

* 일반적으로 하나의 프로그램은 하나의 스레드를 가지지만, 둘 이상의 스레드를 가지는 것

* 하나의 응용프로그램을 여러 개의 스레드로 구성하고 각 스레드로 하여금 하나의 작업을 처리하도록 하는 것

* 웹 서버는 대표적인 멀티 스레드 응용프로그램이다.

* 윈도우, 리눅스 등 많은 운영체제들이 멀티 스레딩을 기본으로 멀티프로세싱을 지원한다.

* 장점

  * 시스템 자원 소모 감소(자원의 효율성 증대)
    * 시스템콜(프로세스를 생성하여 자원을 할당하는 과정)이 줄어들어 자원을 효율적으로 관리할 수 있다.

  - 시스템 처리량 증가(처리 비용 감소)
    - 스레드 간 데이터를 주고받는 것이 간단해지고 시스템 자원 소모가 줄어든다.
    - 스레드 사이의 작업량이 작아 Context Switching이 빠르다.
  - 스레드는 프로세스 내의 Stack영역을 제외한 모든 메모리를 공유하기 때문에 통신의 부담이 적다.

* 단점

  - 설계 / 디버깅이 까다롭다.
  - 단일프로세스 시스템의 경우 효과를 기대하기 어렵다.
  - 자원을 공유하므로 동기화 문제가 발생한다.
  - 하나의 스레드에 문제가 발생하면 전체 프로세스가 영향을 받는다.

<br/>

- 멀티프로세스 대신 멀티 스레드를 사용하는 이유?
  - 프로그램을 여러 개 키는 것보다 하나의 프로그램 안에서 여러 작업을 해결하는 것이다.
- 멀티프로세스로 할 수 있는 작업을 멀티 쓰레딩으로 하는 이유?
  - 프로세스를 생성하여 자원을 할당하는 시스템 콜이 줄어들어 자원을 효율적으로 관리할 수 있다.
  - 프로세스 간의 Context Switching시 오버헤드가 크기 때문.
  - 스레드는 프로세스 내의 메모리를 공유하기 때문에 스레드간 데이터를 주고 받는 것이 간단해지고 시스템 자원소모가 줄어든다.

<br/>

------

[참고 자료]

https://gmlwjd9405.github.io/2018/09/14/process-vs-thread.html

[https://velog.io/@naljajm/%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4Process%EC%99%80-%EC%8A%A4%EB%A0%88%EB%93%9CThread-btk169s36j](https://velog.io/@naljajm/프로세스Process와-스레드Thread-btk169s36j)

https://gbsb.tistory.com/312